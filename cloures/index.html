<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/walt/0.990a875c9837cdd6dc79.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-href="/walt/1.574ddd476aca4086b7e2.css">html{box-sizing:border-box}*,:after,:before{box-sizing:inherit;margin:0;padding:0;outline:0}body{background-color:#fcfcfc;font-family:Roboto,sans-serif}a{text-decoration:none;color:inherit;transition:all .35s ease-in-out}a:hover{color:#f1c232}ul{list-style-position:inside;list-style-type:square}li{margin-bottom:.5em}pre[class*=language-]{font-size:.8em;margin-bottom:1em;background:#fff;border:1px solid #eee}main{max-width:700px;width:100%;margin:auto;font-size:26px}@media (max-width:780px){main{font-size:20px}}header h1{font-weight:700}header h1 a:hover{color:inherit}header nav{padding:1em;font-size:22px;position:absolute;top:0}header nav a:before{content:"-";margin:10px}header nav a:first-child:before{content:""}table{margin-bottom:50px;border-spacing:0;width:100%}table tr{vertical-align:middle}footer{background:#f1c232 linear-gradient(to top right,#f1c232,#f9c21a);width:100vw;position:absolute;left:0}footer>*{max-width:700px;width:100%;margin:auto}footer table tr{vertical-align:middle;text-align:left}footer table td,footer table th{margin:0;padding:1em}footer table td:nth-child(2),footer table th:nth-child(2){border:4px solid #000;border-top:none;border-bottom:none}footer table a{display:block;background-color:#654ff0;color:#fff;padding:10px;border-radius:10px;text-decoration:none;font-size:22px;font-weight:700;border-bottom:4px solid #1f1f1f}footer table a:hover{background-color:#000;color:#fff}@-webkit-keyframes bounce-3px{0%{-webkit-transform:translate(0);transform:translate(0)}50%{-webkit-transform:translateY(3px);transform:translateY(3px)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes bounce-3px{0%{-webkit-transform:translate(0);transform:translate(0)}50%{-webkit-transform:translateY(3px);transform:translateY(3px)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes bounce-5px{0%{-webkit-transform:translate(0);transform:translate(0)}50%{-webkit-transform:translateY(5px);transform:translateY(5px)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes bounce-5px{0%{-webkit-transform:translate(0);transform:translate(0)}50%{-webkit-transform:translateY(5px);transform:translateY(5px)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes intro-init{0%{height:100vh}to{height:87vh}}@keyframes intro-init{0%{height:100vh}to{height:87vh}}@-webkit-keyframes what-lightning-animation{0%{opacity:0}65%{opacity:0}75%{opacity:1}85%{opacity:0}95%{opacity:1}}@keyframes what-lightning-animation{0%{opacity:0}65%{opacity:0}75%{opacity:1}85%{opacity:0}95%{opacity:1}}body.docs header nav{right:1em}body.docs header h1{margin:20px}body.docs header h1 img{vertical-align:middle;margin-right:10px}body.docs h1,body.docs h2,body.docs h3,body.docs p{padding:10px;margin:0}body.docs h1,body.docs h2,body.docs h3{font-weight:700}body.docs h2{font-size:46px;color:#1f1f1f}body.docs h3{font-size:28px;letter-spacing:-1px;color:#654ff0}body.docs hr{width:70%;border:none;border-bottom:2px dashed #424242;margin:auto auto 2em;padding-top:1em}body.docs table thead{border-bottom:1px solid #000;background:#f1c232;color:#000}body.docs table th{padding:5px}body.docs table td{text-align:center}body.docs article{border-bottom:1px dashed #000;margin-bottom:20px;padding-bottom:20px}body.docs article:last-child{border-bottom:none}body.docs article .examples,body.docs article .parameters{margin-top:2em;font-size:16px}body.docs article .examples h4,body.docs article .parameters h4{text-align:center}body.docs article a{text-decoration:underline}body.landing{background:linear-gradient(180deg,#f3f3f3,#e4e4e4);background-attachment:fixed}body.landing hr{width:45%;border:none;border-bottom:6px solid #424242;margin:auto auto 1.5em}body.landing h3{text-align:center;font-size:58px;letter-spacing:-2px;padding:25px 0}body.landing strong{padding:25px 0;display:block}body.landing header{height:100vh;display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;color:#fff;background:#654ff0 linear-gradient(to bottom left,#654ff0,#4733bd);font-weight:400;text-shadow:2px 1px 0 #4733bd}@media (max-width:780px){body.landing header{-webkit-animation:intro-init 1s ease forwards;animation:intro-init 1s ease forwards;-webkit-animation-delay:1s;animation-delay:1s}body.landing header h1{font-size:70px;letter-spacing:-2px}body.landing header h2{font-size:22px;letter-spacing:0}}body.landing header h1{font-size:15vh;letter-spacing:-.5vh}body.landing header h2{font-size:34px;letter-spacing:-2px;font-weight:400}body.landing header figure{display:flex;flex-direction:column;justify-content:center;align-items:center}body.landing header figure img{width:38vh}body.landing header figure .hat{-webkit-animation:bounce-3px 1s ease infinite;animation:bounce-3px 1s ease infinite}body.landing header figure .glasses{-webkit-animation:bounce-5px 1s ease infinite;animation:bounce-5px 1s ease infinite}body.landing header nav{width:100%;border-bottom:1px solid #fff}</style><meta name="generator" content="Gatsby 2.0.19"/><link rel="shortcut icon" href="/walt/icons/icon-48x48.png"/><link rel="manifest" href="/walt/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><title data-react-helmet="true">Closures - Walt - JavaScript-like syntax for WebAssembly</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet"/><link data-react-helmet="true" href="/walt/static/favicon-438019e3da59a6c51f3fe768e39659ea.png" rel="icon" type="image/png"/><meta data-react-helmet="true" name="description" content="Walt is an alternative syntax for the WebAssembly text format."/><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:image" content="/walt/static/facebook-9a59a1b5277b809535f8f38169b1bdcb.jpg"/><link as="script" rel="preload" href="/walt/1-a9724f0223d14f48b2f7.js"/><link as="script" rel="preload" href="/walt/app-7c5067a32144f95e5315.js"/><link as="script" rel="preload" href="/walt/component---src-components-docs-template-js-b1986de463269191a3d2.js"/><link as="script" rel="preload" href="/walt/0-067e2ab60a13d3495133.js"/><link as="script" rel="preload" href="/walt/webpack-runtime-4f0cf2e890db074a000f.js"/><link rel="preload" href="/walt/static/d/492/path---cloures-993-801-HxbpU40RR97A1ag1E0FmBv5KVQU.json" as="fetch" crossOrigin="use-credentials"/></head><body class="docs"><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header><h1><img width="85" src="data:image/png;base64,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" alt=""/><a href="/walt/">Docs</a></h1><nav><a title="Live DEMO of Walt" href="/walt/demo">demo</a><a title="Dive in WALT&#x27;s documentation" href="/walt/docs">docs</a><a href="https://github.com/ballercat/walt" title="WALT on GitHub">github</a></nav></header><main><section class="content"><h1>Intro</h1>
<p>Closures are a very powerful abstraction in JavaScript, because of this Walt supports a very straightforward syntax for working with closures.</p>
<h2>Syntax</h2>
<p>A closure is a function which is defined by the ES6-like anonymous arrow function syntax. Unlike regular functions in JavaScript, an inner closure can only be created with an arrow function.</p>
<p>Like function pointers, a closure <em>instance</em> must be associated with an appropriate type definition. In Walt a regular function type can be modified with the <code class="language-text">lambda</code> keyword to indicate to the compiler that this function type will be used as a closure.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Reads as: "a function type, which is a lambda taking no arguments and returning 32-bit integer"</span>
type lambda <span class="token function-variable function">Closure</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> i32<span class="token punctuation">;</span></code></pre></div>
<p><strong>A table must be present in the module before you can invoke closures</strong>. A closure call is ultimately an <code class="language-text">indirect_call</code>/function-pointer and requires a table.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> table<span class="token punctuation">:</span> Table <span class="token operator">=</span> <span class="token punctuation">{</span> element<span class="token punctuation">:</span> anyfunc<span class="token punctuation">,</span> initial<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Unlike regular functions types(like the ones used for imports), lambdas are <em>64-bits</em> wide. Without the <code class="language-text">lambda</code> modifier a function type will be treated as a regular function pointer type, which <em>32-bits</em> wide.</p>
<p><strong>To return a closure from a function</strong> all you need to do is annotate it with a lambda type and return a closure.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Closure <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// Not a very useful closure, but good enough for a demo</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> i32 <span class="token punctuation">{</span>
    x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>To store a closure in a variable</strong>, a variable must be annotated with the closure Type.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> count<span class="token punctuation">:</span> Closure <span class="token operator">=</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>A closure is used just like any other function pointer.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> i32 <span class="token punctuation">{</span>
  <span class="token comment">// create a variable</span>
  <span class="token keyword">const</span> count<span class="token punctuation">:</span> Closure <span class="token operator">=</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// this will be 3</span>
  <span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Compiling</h2>
<p>Closures are a <em>optional</em> feature. The compiler will not generate any additional code to handle them unless they are used within the source. When you do define a closure within your source, the compiler will generate imports for a <code class="language-text">walt-plugin-closure</code>. This import must exist in order for closures to be used and invoked in the final WebAssembly binary.</p>
<p>Using the closure plugin is rather simple and can be seen in the <a href="https://ballercat.github.io/walt/">Explorer Demo page</a></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span> closurePlugin<span class="token punctuation">,</span> withPlugins <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'walt-compiler'</span><span class="token punctuation">;</span>

<span class="token comment">// First we need an instance of the closure plugin</span>
WebAssembly<span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token function">closurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>closure <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> WebAssembly<span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>
    <span class="token comment">// walt source code to buffer    </span>
    <span class="token function">compiler</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Inject the plugin into the importsObj</span>
    <span class="token function">withPlugins</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      closure
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>module <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> test <span class="token operator">=</span> module<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>test<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><em>Future version of the compiler will have a helper method which will abstract this for you</em>.</p>
<h3>Plugin</h3>
<p>The purpose of the plugin is to define <strong>a separate memory space for dynamic closures</strong>. Walt does not come with a memory runtime and never touches the memory defined in your module implicitly. To get around this, features that <em>do</em> require dynamic memory are offloaded to another WebAssembly module which is dynamically linked during compilation, a plugin. Because the imports are other WebAssembly methods, <strong>there is no additional overhead to invoking these methods</strong>.</p>
<p>This abstraction allows for the end-user to overwrite the closure plugin. You may decide you have a better or more performant closure allocator that you'd like to use. You can even define the plugin methods entirely in JavaScript, however that will incur a runtime penalty for invoking JS functions from WebAssembly.</p>
<p><em>*At this point the default Closure plugin is very basic and does not fully implement a free() method</em>.</p>
<h4>ABI</h4>
<p>The following imports and types are injected at the top of your module when using closures.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">    <span class="token keyword">import</span> <span class="token punctuation">{</span>
      <span class="token string">'closure-malloc'</span><span class="token punctuation">:</span> ClosureGeti32<span class="token punctuation">,</span>
      <span class="token string">'closure-free'</span><span class="token punctuation">:</span> ClosureFree<span class="token punctuation">,</span>
      <span class="token string">'closure--get-i32'</span><span class="token punctuation">:</span> ClosureGeti32<span class="token punctuation">,</span>
      <span class="token string">'closure--get-f32'</span><span class="token punctuation">:</span> ClosureGetf32<span class="token punctuation">,</span>
      <span class="token string">'closure--get-i64'</span><span class="token punctuation">:</span> ClosureGeti64<span class="token punctuation">,</span>
      <span class="token string">'closure--get-f64'</span><span class="token punctuation">:</span> ClosureGetf64<span class="token punctuation">,</span>
      <span class="token string">'closure--set-i32'</span><span class="token punctuation">:</span> ClosureSeti32<span class="token punctuation">,</span>
      <span class="token string">'closure--set-f32'</span><span class="token punctuation">:</span> ClosureSetf32<span class="token punctuation">,</span>
      <span class="token string">'closure--set-i64'</span><span class="token punctuation">:</span> ClosureSeti64<span class="token punctuation">,</span>
      <span class="token string">'closure--set-f64'</span><span class="token punctuation">:</span> ClosureSetf64
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'walt-plugin-closure'</span><span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureFree</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureGeti32</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span> <span class="token operator">=></span> i32<span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureGetf32</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span> <span class="token operator">=></span> f32<span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureGeti64</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span> <span class="token operator">=></span> i64<span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureGetf64</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span> <span class="token operator">=></span> f64<span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureSeti32</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureSetf32</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> f32<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureSeti64</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i64<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    type <span class="token function-variable function">ClosureSetf64</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> f64<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span></code></pre></div>
<p>You are free to overwrite all of a subset of these imports via the <code class="language-text">importsObject</code> argument.</p>
<h2>Details for Nerds</h2>
<p>For low-level implementation details see <a href="https://github.com/ballercat/walt/pull/66">Closures PR</a></p></section></main></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-docs-template-js","jsonName":"cloures-993","path":"/cloures"};window.dataPath="492/path---cloures-993-801-HxbpU40RR97A1ag1E0FmBv5KVQU";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-7c5067a32144f95e5315.js"],"component---src-components-docs-template-js":["/component---src-components-docs-template-js-b1986de463269191a3d2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9fe99f8edb0ae034cfa1.js"],"component---src-pages-api-js":["/component---src-pages-api-js-ec6c8675c3d04b99acee.js"],"component---src-pages-demo-js":["/component---src-pages-demo-js-97b9bd5bedbec221ab2e.js"],"component---src-pages-docs-js":["/component---src-pages-docs-js-076371c17da7dd622d19.js"],"component---src-pages-index-js":["/component---src-pages-index-js.6e086c5ce4b8512f3f8a.css","/component---src-pages-index-js-3f00d297e3ba09920d80.js"]};/*]]>*/</script><script src="/walt/webpack-runtime-4f0cf2e890db074a000f.js" async=""></script><script src="/walt/0-067e2ab60a13d3495133.js" async=""></script><script src="/walt/component---src-components-docs-template-js-b1986de463269191a3d2.js" async=""></script><script src="/walt/app-7c5067a32144f95e5315.js" async=""></script><script src="/walt/1-a9724f0223d14f48b2f7.js" async=""></script></body></html>